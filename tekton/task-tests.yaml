apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: run-node-tests
  namespace: gitops-demo
spec:
  params:
    - name: APP_PATH
      type: string
      default: app
  workspaces:
    - name: source
  steps:
    - name: npm-test
      image: harbor.skyr.dca.scc/gitops/nodejs-18:latest
      workingDir: $(workspaces.source.path)/$(params.APP_PATH)
      script: |
        #!/usr/bin/env bash
        set -euo pipefail
        npm ci
        npm test
